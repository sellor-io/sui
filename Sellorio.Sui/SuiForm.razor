@using Sellorio.Sui.Layout

<CascadingValue Value="this" IsFixed>
	<SuiDisableStateProvider @ref="disableStateProvider">
		<MudForm @ref="form" Disabled="Disabled" SuppressImplicitSubmission="false" Style="@($"max-width:{Constants.MaxFormWidth}")">
			<button type="submit" style="display:none" @onclick="OnSubmitAsync"></button>
			@ChildContent
		</MudForm>
	</SuiDisableStateProvider>
</CascadingValue>

@code {
	MudForm? form;
	SuiDisableStateProvider? disableStateProvider;

	public bool IsSubmitting { get; private set; }

	[Parameter]
	public EventCallback OnValidSubmit { get; set; }

	[Parameter]
	public bool Disabled { get; set; }

	[Parameter]
	public RenderFragment? ChildContent { get; set; }

	internal async Task OnSubmitAsync()
	{
		if (!OnValidSubmit.HasDelegate || form == null)
		{
			return;
		}

		await form.Validate();

		if (form.IsValid)
		{
			disableStateProvider!.UpdateState(true);
			IsSubmitting = true;
			await OnValidSubmit.InvokeAsync();
			IsSubmitting = false;
			disableStateProvider.UpdateState(false);
		}
	}
}
